<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.gmall.product.mapper.SkuInfoMapper">
    <select id="getGoodsBySkuId" resultMap="getGoodsBySkuIdMap">
        SELECT
            si.id,
            si.sku_default_img AS default_img,
            si.sku_name AS title,
            si.price,
            bt.id AS tm_id,
            bt.tm_name,
            bt.logo_url AS tm_logo_url,
            c1.id AS category1_id,
            c1.`name` AS category1_name,
            c2.id AS category2_id,
            c2.`name` AS category2_name,
            c3.id AS category3_id,
            c3.`name` AS category3_name,
            0 AS hot_score,
            bi.id AS attr_id,
            bi.attr_name,
            bv.value_name AS attr_value
        FROM
            sku_info si,
            sku_attr_value sav,
            base_attr_info bi,
            base_attr_value bv,
            base_trademark bt,
            base_category3 c3,
            base_category2 c2,
            base_category1 c1
        WHERE
            si.id = sav.sku_id
            AND sav.attr_id = bi.id
            AND bi.id = bv.attr_id
            AND si.tm_id = bt.id
            AND si.category3_id = c3.id
            AND c3.category2_id = c2.id
            AND c2.category1_id = c1.id
            AND si.id = #{skuId}
    </select>

    <resultMap id="getGoodsBySkuIdMap" type="com.atguigu.gmall.model.list.Goods" autoMapping="true">
        <id column="id" property="id"></id>
        <collection property="attrs" ofType="com.atguigu.gmall.model.list.SearchAttr" autoMapping="true">
            <id column="attr_id" property="attrId"></id>
        </collection>
    </resultMap>
</mapper>